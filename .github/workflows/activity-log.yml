name: ğŸš€ Auto Update Activity Log

on:
  push:
    branches:
      - main
  schedule:
    - cron: '0 0 * * *' # æ¯æ—¥åˆå¤œåŸ·è¡Œä¸€æ¬¡ï¼Œç¢ºä¿å®šæ™‚æ›´æ–°
  workflow_dispatch:

permissions:
  contents: write # ç¢ºä¿ Action æœ‰å¯«å…¥ README.md çš„æ¬Šé™

jobs:
  update-readme:
    runs-on: ubuntu-latest
    
    # é¿å… Action è‡ªèº«çš„æäº¤é‡è¤‡è§¸ç™¼ Workflow
    if: github.actor != 'github-actions[bot]'

    steps:
      - name: â¬‡ï¸ Checkout Repository Code with PAT
        uses: actions/checkout@v4
        with:
          # ä½¿ç”¨æ‚¨çš„ PAT Secret é€²è¡Œ Checkoutï¼Œç¢ºä¿æœ‰æ¬Šé™é€²è¡Œå¾ŒçºŒçš„ Push
          token: ${{ secrets.TOKEN }} 
          fetch-depth: 0
          
      - name: ğŸƒâ€â™‚ï¸ Run Activity Log Generator
        uses: TheDanniCraft/activity-log@v1
        with:
          # 1. ã€ä¿®æ­£ã€‘æä¾›å¿…è¦çš„ GITHUB_USERNAME
          GITHUB_USERNAME: YiSanChen 

          # 2. ã€ä¿®æ­£ã€‘Action è¦æ±‚åç‚º GITHUB_TOKEN çš„è¼¸å…¥ï¼Œæˆ‘å€‘å°‡ PAT å‚³éçµ¦å®ƒ
          GITHUB_TOKEN: ${{ secrets.TOKEN }}
          
          # 3. ã€ä¿®æ­£ã€‘Action çš„è¼¸å…¥åƒæ•¸åç‚º README_PATHï¼Œè€Œä¸æ˜¯ SECTION_NAME
          # SECTION_NAME åªæ˜¯ç”¨æ–¼é…ç½®æª”æ¡ˆï¼ˆä½†é€™å€‹ Action æ²’æœ‰é€™å€‹è¼¸å…¥ï¼‰
          # æ ¹æ“šæ–‡ä»¶ï¼Œå¦‚æœæ‚¨çš„ä½”ä½ç¬¦æ˜¯ <!--START_SECTION:activity-->ï¼Œä¸”åœ¨ README.md æ ¹ç›®éŒ„ï¼Œå®ƒæœƒè‡ªå‹•åµæ¸¬ï¼Œé€™è£¡å…ˆä¸åŠ ã€‚

      - name: ğŸ”„ Commit Updated README
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ¤– Auto: Update activity log in README [skip ci]"
          commit_user_name: 'github-actions[bot]'
          commit_user_email: '41898282+github-actions[bot]@users.noreply.github.com'
          files: 'README.md'
          # ä½¿ç”¨æ‚¨çš„ PAT Secret ä¾†æäº¤è®Šæ›´
          token: ${{ secrets.TOKEN }}
