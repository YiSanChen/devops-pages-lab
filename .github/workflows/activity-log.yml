name: 🚀 Auto Update Activity Log

on:
  push:
    branches:
      - main
  # 建議加上 schedule，確保活動能定時更新，即使沒有新的 push
  schedule:
    - cron: '0 0 * * *' # 每日午夜執行一次
  workflow_dispatch:

# 權限：必須有寫入權限才能修改 README.md
permissions:
  contents: write

jobs:
  update-readme:
    runs-on: ubuntu-latest
    
    # 【修正 2：防止 Action 自身提交重複觸發】
    # 僅當提交者不是 GitHub Bot 時才運行，避免無限循環
    if: github.actor != 'github-actions[bot]'

    steps:
      - name: ⬇️ Checkout Repository Code
        uses: actions/checkout@v4
        # 使用 PAT Token 進行 Checkout，讓後續操作能讀取私有 repo 的活動
        with:
          token: ${{ secrets.TOKEN }} # 使用您設定的 PAT Secret
          fetch-depth: 0
          
      - name: 🏃‍♂️ Run Activity Log Generator
        uses: TheDanniCraft/activity-log@v1
        with:
          # 【修正 1：將 GITHUB_USERNAME 移到 with 區塊】
          # 此 Action 預期 GITHUB_USERNAME 為輸入參數 (input)，而不是環境變數 (env)
          GITHUB_USERNAME: YiSanChen # 替換為您的實際 GitHub 使用者名稱

          # 這是用於 API 請求的 Token。這裡應該使用您設定的 PAT Secret (TOKEN)
          TOKEN: ${{ secrets.TOKEN }}
          
          # 建議加上 SECTION_NAME，確保 Action 知道要替換的區塊
          SECTION_NAME: activity 
          
      - name: 🔄 Commit Updated README
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "🤖 Auto: Update activity log in README [skip ci]"
          commit_user_name: 'github-actions[bot]'
          commit_user_email: '41898282+github-actions[bot]@users.noreply.github.com'
          files: 'README.md'
          # 使用預設的 GITHUB_TOKEN，此 Action 提交時會自動使用 Bot 帳號，
          # 且不會再次觸發 push event，但為確保權限，這裡仍建議使用您的 PAT
          token: ${{ secrets.TOKEN }}
